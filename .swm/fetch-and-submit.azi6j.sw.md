---
id: azi6j
name: Fetch and Submit
file_version: 1.0.2
app_version: 0.7.0-1
file_blobs:
  src/lib/data/fetch.ts: 28f53e6c50892bb8fb9d4df8d42aeeb1a12843fc
  src/lib/data/submit.ts: b274f5952c596745f41041746ba777a0b9f1addc
---

Here we will discuss how we access the Advent of Code API endpoints for getting the puzzle input and submitting answers.

# fetch.ts

<br/>

This is the only exported function from this file. It calls `load`[<sup id="Z1i1CgX">â†“</sup>](#f-Z1i1CgX) to get the puzzle input as a string, then returns it trimmed and split into an array of lines.

So if you had a file like

`100\n200\nabc`

you would end up with an array like `["100", "200", "abc"]`
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ src/lib/data/fetch.ts
```typescript
â¬œ 12     
ðŸŸ© 13       const text = await load(year, day)
ðŸŸ© 14       return text.trim().split(/\r?\n/)
â¬œ 15     }
â¬œ 16     
```

<br/>

Here we check to see if the file already exists locally, or if we need to pull it from the website. We don't hit the website if we already have the input, in order to be a good citizen and not cost Eric extra money.
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ src/lib/data/fetch.ts
```typescript
â¬œ 17     async function load(year: string, day: string): Promise<string> {
â¬œ 18       const filePath = resolve(process.cwd(), `./data/${year}/day${day}.txt`)
â¬œ 19     
ðŸŸ© 20       if (existsSync(filePath)) {
ðŸŸ© 21         return await readFile(filePath, 'utf8')
ðŸŸ© 22       } else {
ðŸŸ© 23         const { session }: { session: string } = JSON.parse(
ðŸŸ© 24           process.env.CONFIG ?? ''
ðŸŸ© 25         )
ðŸŸ© 26         const content = await loadFromRemote(year, day, session)
ðŸŸ© 27         await mkdir(dirname(filePath), { recursive: true })
ðŸŸ© 28         await writeFile(filePath, content, 'utf8')
ðŸŸ© 29         return content
ðŸŸ© 30       }
â¬œ 31     }
â¬œ 32     
â¬œ 33     async function loadFromRemote(
```

<br/>

# submit.ts

<br/>

This is the only exported function from this file. It executes a POST request with the native `fetch` function. Note that if you don't specify `application/x-www-form-urlencoded`, or if you don't use the method below to URL encode the search params, the endpoint will silently fail (it returns 200, but doesn't actually submit anything and just returns the HTML of the problem again).
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ src/lib/data/submit.ts
```typescript
â¬œ 15       const { session }: { session: string } = JSON.parse(process.env.CONFIG ?? '')
â¬œ 16     
ðŸŸ© 17       const urlencoded = new URLSearchParams()
ðŸŸ© 18       urlencoded.append('level', part)
ðŸŸ© 19       urlencoded.append('answer', str)
ðŸŸ© 20     
ðŸŸ© 21       const response = await fetch(
ðŸŸ© 22         `https://adventofcode.com/${year}/day/${day}/answer`,
ðŸŸ© 23         {
ðŸŸ© 24           method: 'POST',
ðŸŸ© 25           body: urlencoded as unknown as string,
ðŸŸ© 26           headers: {
ðŸŸ© 27             'content-type': 'application/x-www-form-urlencoded',
ðŸŸ© 28             cookie: `session=${session}`
ðŸŸ© 29           }
ðŸŸ© 30         }
ðŸŸ© 31       )
â¬œ 32     
â¬œ 33       if (response.ok) {
â¬œ 34         const result = await response.text()
```

<br/>

We want to remember what input we've already sent to the puzzle, because if we send the same wrong answer it just wastes time.

For instance, if we submit `100` and get HTML back with "That's not the right answer, your answer is too high", we save that as a file `100.html` in the folder for the puzzle we're solving.
<!-- NOTE-swimm-snippet: the lines below link your snippet to Swimm -->
### ðŸ“„ src/lib/data/submit.ts
```typescript
â¬œ 31       )
â¬œ 32     
â¬œ 33       if (response.ok) {
ðŸŸ© 34         const result = await response.text()
ðŸŸ© 35         console.log(result)
ðŸŸ© 36     
ðŸŸ© 37         const filePath = resolve(
ðŸŸ© 38           process.cwd(),
ðŸŸ© 39           `./src/${year}/attempts/day${day}/part${part}/${str}.html`
ðŸŸ© 40         )
ðŸŸ© 41     
ðŸŸ© 42         await mkdir(dirname(filePath), { recursive: true })
ðŸŸ© 43         await writeFile(filePath, result, 'utf8')
ðŸŸ© 44     
ðŸŸ© 45         return result.includes("That's the right answer")
â¬œ 46       }
â¬œ 47     
â¬œ 48       throw new Error(`Error when trying to submit... ${JSON.stringify(response)}`)
```

<br/>

<!-- THIS IS AN AUTOGENERATED SECTION. DO NOT EDIT THIS SECTION DIRECTLY -->
### Swimm Note

<span id="f-Z1i1CgX">load</span>[^](#Z1i1CgX) - "src/lib/data/fetch.ts" L13
```typescript
  const text = await load(year, day)
```

<br/>

This file was generated by Swimm. [Click here to view it in the app](https://app.swimm.io/repos/Z2l0aHViJTNBJTNBYW9janMtY2xpJTNBJTNBZWxsaW90Zmlza2U=/docs/azi6j).